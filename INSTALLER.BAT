@echo off
chcp 65001 >nul
title LinkedIn Assistant - Instalador

echo.
echo ========================================
echo    LINKEDIN ASSISTANT - INSTALADOR
echo ========================================
echo.
echo üöÄ Este instalador configurar√° todo autom√°ticamente
echo üì¶ Se instalar√°n: Python, dependencias y estructura
echo.
echo ‚ö†Ô∏è  Aseg√∫rate de tener:
echo    ‚Ä¢ Windows 10 o superior
echo    ‚Ä¢ Conexi√≥n a Internet activa
echo    ‚Ä¢ Permisos de administrador (recomendado)
echo.

REM Verificar si Python est√° instalado
echo üîç Verificando Python...
python --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Python no est√° instalado
    echo.
    echo üì• Instalando Python autom√°ticamente...
    
    REM Descargar Python
    powershell -Command "Invoke-WebRequest -Uri 'https://www.python.org/ftp/python/3.9.13/python-3.9.13-amd64.exe' -OutFile 'python_installer.exe'"
    
    if exist python_installer.exe (
        echo ‚úÖ Python descargado. Ejecutando instalador...
        echo ‚è≥ Esto puede tomar unos minutos...
        start /wait python_installer.exe /quiet InstallAllUsers=1 PrependPath=1
        del python_installer.exe
        
        echo ‚úÖ Python instalado. Reiniciando instalaci√≥n...
        timeout /t 3 /nobreak >nul
        call "%~f0"
        exit /b
    ) else (
        echo ‚ùå No se pudo descargar Python
        echo üì• Descarga manualmente desde: https://www.python.org/downloads/
        pause
        exit /b 1
    )
)

echo ‚úÖ Python detectado: 
python --version

REM Crear carpeta del proyecto
echo.
echo üìÅ Creando estructura de carpetas...
if not exist "linkedin_assistant" mkdir linkedin_assistant
cd linkedin_assistant

mkdir exports 2>nul
mkdir logs 2>nul
mkdir backups 2>nul
mkdir session 2>nul
mkdir static 2>nul
mkdir templates 2>nul

echo ‚úÖ Carpetas creadas

REM Crear entorno virtual
echo.
echo üêç Creando entorno virtual Python...
python -m venv venv
if errorlevel 1 (
    echo ‚ùå Error creando entorno virtual
    pause
    exit /b 1
)

echo ‚úÖ Entorno virtual creado

REM Activar entorno e instalar dependencias
echo.
echo üì¶ Instalando dependencias...
call venv\Scripts\activate.bat
if errorlevel 1 (
    echo ‚ùå Error activando entorno virtual
    pause
    exit /b 1
)

pip install --upgrade pip
pip install selenium==4.15.2 flask==3.0.0 pyyaml==6.0.1

echo ‚úÖ Dependencias instaladas

REM Crear archivos de configuraci√≥n
echo.
echo ‚öôÔ∏è  Creando archivos de configuraci√≥n...

REM Crear config.yaml b√°sico
(
echo # üõ°Ô∏è CONFIGURACI√ìN DE LINKEDIN ASSISTANT
echo.
echo linkedin:
echo   email: "TU_EMAIL_AQUI@ejemplo.com"
echo   password: "TU_CONTRASE√ëA_AQUI"
echo.
echo limits:
echo   daily_connections: 25
echo   weekly_connections: 100
echo   connections_per_hour: 8
echo   messages_per_day: 40
echo   min_action_delay: 12
echo   max_action_delay: 30
echo.
echo search:
echo   keywords: "CEO Founder Director"
echo   locations: "Espa√±a"
echo   industries: "Tecnolog√≠a"
echo.
echo messages:
echo   connection_request:
echo     - template: "Hola {{first_name}}, vi tu perfil y me gustar√≠a conectar."
echo.
echo behavior:
echo   work_schedule:
echo     monday: ["09:00", "18:00"]
echo     tuesday: ["09:00", "18:00"]
echo     wednesday: ["09:00", "18:00"]
echo     thursday: ["09:00", "18:00"]
echo     friday: ["09:00", "16:00"]
echo     saturday: []
echo     sunday: []
) > config.yaml

echo ‚úÖ config.yaml creado

REM Crear archivos Python principales
echo.
echo ü§ñ Creando archivos del bot...

REM linkedin_bot.py (versi√≥n simplificada para instalaci√≥n)
(
echo import time
echo import random
echo import yaml
echo.
echo print("LinkedIn Bot - Instalaci√≥n completada")
echo print("Por favor, configura tu config.yaml primero")
) > linkedin_bot.py

REM app.py (versi√≥n simplificada)
(
echo from flask import Flask
echo.
echo app = Flask(__name__)
echo.
echo @app.route('/')
echo def home():
echo     return "LinkedIn Assistant - Instalaci√≥n completada"
echo.
echo if __name__ == "__main__":
echo     app.run(debug=True)
) > app.py

REM Crear archivos de inicio
echo.
echo üöÄ Creando archivos de inicio...

REM Crear inicio.bat
(
echo @echo off
echo chcp 65001 ^>nul
echo title LinkedIn Assistant
echo.
echo echo ========================================
echo echo    LINKEDIN ASSISTANT - INICIANDO
echo echo ========================================
echo echo.
echo.
echo REM Verificar ChromeDriver
echo if not exist "chromedriver.exe" (
echo     echo ‚ùå ERROR: No se encontr√≥ chromedriver.exe
echo     echo.
echo     echo üì• Para solucionarlo:
echo     echo 1. Ve a https://chromedriver.chromium.org/
echo     echo 2. Descarga la versi√≥n compatible con tu Chrome
echo     echo 3. Guarda el archivo como chromedriver.exe aqu√≠
echo     echo.
echo     echo üîç Para ver tu versi√≥n de Chrome:
echo     echo    ‚Ä¢ Abre Chrome
echo     echo    ‚Ä¢ Haz clic en los 3 puntos ‚Üí Ayuda ‚Üí Acerca de Google Chrome
echo     echo.
echo     pause
echo     exit /b 1
echo )
echo.
echo REM Verificar config.yaml
echo if not exist "config.yaml" (
echo     echo ‚ùå ERROR: No se encontr√≥ config.yaml
echo     echo Crea el archivo de configuraci√≥n primero
echo     pause
echo     exit /b 1
echo )
echo.
echo REM Activar entorno virtual
echo call venv\Scripts\activate.bat
echo.
echo REM Iniciar aplicaci√≥n
echo python app.py
echo pause
) > inicio.bat

REM Crear configurar.bat
(
echo @echo off
echo chcp 65001 ^>nul
echo title Configurar LinkedIn Assistant
echo.
echo echo ========================================
echo echo    CONFIGURACI√ìN PASO A PASO
echo echo ========================================
echo echo.
echo echo üìù Vamos a configurar tu LinkedIn Assistant:
echo echo.
echo.
echo REM 1. ChromeDriver
echo if not exist "chromedriver.exe" (
echo     echo üîß PASO 1: Instalar ChromeDriver
echo     echo.
echo     echo 1. Abre Google Chrome
echo     echo 2. Haz clic en los 3 puntos (arriba derecha)
echo     echo 3. Ve a "Ayuda" ‚Üí "Acerca de Google Chrome"
echo     echo 4. Anota el n√∫mero de versi√≥n (ej: 120.0.6099.130)
echo     echo.
echo     echo ‚è≥ Abriendo navegador para descargar...
echo     start "" "https://chromedriver.chromium.org/"
echo     echo.
echo     echo üì• Descarga la versi√≥n que coincida con tu Chrome
echo     echo üí° Ejemplo: Si tienes Chrome 120, descarga ChromeDriver 120.x.x.x
echo     echo.
echo     pause
echo ) else (
echo     echo ‚úÖ ChromeDriver ya instalado
echo )
echo.
echo REM 2. Configuraci√≥n b√°sica
echo echo.
echo echo üîß PASO 2: Configurar credenciales
echo echo.
echo echo Abriendo config.yaml para editar...
echo timeout /t 2 /nobreak ^>nul
echo.
echo if not exist "config.yaml" (
echo     echo ‚ùå config.yaml no encontrado
echo     pause
echo     exit /b 1
echo )
echo.
echo REM Abrir con editor predeterminado
echo start "" "config.yaml"
echo.
echo echo üí° INSTRUCCIONES:
echo echo 1. Cambia TU_EMAIL_AQUI@ejemplo.com por tu email real
echo echo 2. Cambia TU_CONTRASE√ëA_AQUI por tu contrase√±a real
echo echo 3. Ajusta keywords, locations, industries a tu nicho
echo echo 4. Guarda el archivo y cierra el editor
echo echo.
echo echo ‚ö†Ô∏è  CONSEJO DE SEGURIDAD:
echo echo ‚Ä¢ Nunca compartas este archivo con nadie
echo echo ‚Ä¢ Mant√©n una copia de seguridad de tus datos
echo echo.
echo pause
echo.
echo echo ‚úÖ Configuraci√≥n completada
echo echo.
echo echo üöÄ Ahora puedes ejecutar inicio.bat para comenzar
echo pause
) > configurar.bat

REM Crear actualizar.bat
(
echo @echo off
echo chcp 65001 ^>nul
echo title Actualizar LinkedIn Assistant
echo.
echo echo ========================================
echo echo    ACTUALIZANDO LINKEDIN ASSISTANT
echo echo ========================================
echo echo.
echo.
echo REM Activar entorno virtual
echo call venv\Scripts\activate.bat
echo.
echo REM Actualizar dependencias
echo echo üì¶ Actualizando Python packages...
echo pip install --upgrade selenium flask pyyaml
echo.
echo REM Verificar ChromeDriver
echo echo üîç Verificando versi√≥n de ChromeDriver...
echo if exist chromedriver.exe (
echo     echo ‚úÖ ChromeDriver encontrado
echo     echo üí° Recuerda actualizarlo si actualizas Chrome
echo ) else (
echo     echo ‚ö†Ô∏è  ChromeDriver no encontrado
echo     echo Ejecuta configurar.bat primero
echo )
echo.
echo echo ‚úÖ Actualizaci√≥n completada
echo pause
) > actualizar.bat

REM Crear README.txt
echo.
echo üìñ Creando documentaci√≥n...
(
echo ========================================
echo      LINKEDIN ASSISTANT - GU√çA R√ÅPIDA
echo ========================================
echo.
echo üéØ OBJETIVO: Conectar con 25-30 personas/d√≠a
echo             de forma segura y autom√°tica
echo.
echo üìÅ ARCHIVOS IMPORTANTES:
echo ‚Ä¢ config.yaml - Tu configuraci√≥n (EDITAR ESTE)
echo ‚Ä¢ inicio.bat - Para iniciar el programa
echo ‚Ä¢ configurar.bat - Para configurar paso a paso
echo ‚Ä¢ actualizar.bat - Para actualizar dependencias
echo.
echo üöÄ C√ìMO COMENZAR (3 PASOS):
echo.
echo 1. EJECUTA configurar.bat
echo    Te guiar√° para instalar ChromeDriver
echo    y configurar tus credenciales
echo.
echo 2. EDITA config.yaml
echo    ‚Ä¢ Cambia email y contrase√±a
echo    ‚Ä¢ Ajusta keywords a tu nicho
echo    ‚Ä¢ Configura l√≠mites seguros
echo.
echo 3. EJECUTA inicio.bat
echo    Se abrir√° una ventana web en tu navegador
echo    Usa los botones para controlar el bot
echo.
echo ‚ö†Ô∏è  CONSEJOS DE SEGURIDAD:
echo ‚Ä¢ Nunca superes 25 conexiones/d√≠a
echo ‚Ä¢ Usa horarios laborales reales
echo ‚Ä¢ Personaliza los mensajes
echo ‚Ä¢ Haz backup regular de exports/
echo.
echo ‚ùì PROBLEMAS COMUNES:
echo.
echo 1. "No se encontr√≥ chromedriver.exe"
echo    Soluci√≥n: Ejecuta configurar.bat
echo.
echo 2. "Error de login"
echo    Soluci√≥n: Verifica email/contrase√±a en config.yaml
echo.
echo 3. "LinkedIn pide verificaci√≥n"
echo    Soluci√≥n: Espera 24 horas, reduce l√≠mites
echo.
echo üìû SOPORTE:
echo Guarda los archivos de logs/ si necesitas ayuda
echo.
echo ========================================
echo         ¬°√âXITO CON TU PROSPECCI√ìN!
echo ========================================
) > README.txt

echo ‚úÖ Archivos creados

REM Descargar ChromeDriver autom√°ticamente
echo.
echo üîç Detectando versi√≥n de Chrome...
for /f "tokens=2 delims= " %%a in ('reg query "HKEY_CURRENT_USER\Software\Google\Chrome\BLBeacon" /v version 2^>nul') do set CHROME_VERSION=%%a

if "%CHROME_VERSION%"=="" (
    echo ‚ö†Ô∏è  No se pudo detectar Chrome autom√°ticamente
    echo üì• Necesitar√°s descargar ChromeDriver manualmente
) else (
    echo ‚úÖ Chrome detectado: Versi√≥n %CHROME_VERSION%
    echo.
    echo üì• Intentando descargar ChromeDriver autom√°ticamente...
    
    REM Extraer versi√≥n mayor (ej: 120.0.6099.130 ‚Üí 120)
    for /f "tokens=1 delims=." %%v in ("%CHROME_VERSION%") do set MAJOR_VERSION=%%v
    
    powershell -Command ^
    "try {
        $url = 'https://chromedriver.storage.googleapis.com/LATEST_RELEASE_' + '%MAJOR_VERSION%'
        $version = Invoke-WebRequest -Uri $url -UseBasicParsing
        $downloadUrl = 'https://chromedriver.storage.googleapis.com/' + $version.Content + '/chromedriver_win32.zip'
        
        Invoke-WebRequest -Uri $downloadUrl -OutFile 'chromedriver.zip'
        
        if (Test-Path 'chromedriver.zip') {
            Expand-Archive -Path 'chromedriver.zip' -DestinationPath . -Force
            Remove-Item 'chromedriver.zip'
            Write-Host '‚úÖ ChromeDriver descargado autom√°ticamente'
        }
    } catch {
        Write-Host '‚ö†Ô∏è  No se pudo descargar autom√°ticamente'
        Write-Host 'üì• Descarga manual desde: https://chromedriver.chromium.org/'
    }"
)

echo.
echo ========================================
echo        üéâ INSTALACI√ìN COMPLETADA
echo ========================================
echo.
echo ‚úÖ TODO LISTO
echo.
echo üìù AHORA NECESITAS:
echo 1. Ejecutar configurar.bat (para configuraci√≥n guiada)
echo    O
echo 2. Editar manualmente config.yaml con tus datos
echo.
echo üöÄ LUEGO EJECUTA:
echo ‚Ä¢ inicio.bat - Para iniciar el programa
echo.
echo üìÅ EN ESTA CARPETA ENCONTRAR√ÅS:
echo ‚Ä¢ config.yaml - Configuraci√≥n (¬°EDITA ESTE!)
echo ‚Ä¢ inicio.bat - Para iniciar
echo ‚Ä¢ configurar.bat - Configuraci√≥n guiada
echo ‚Ä¢ actualizar.bat - Para actualizar
echo ‚Ä¢ README.txt - Esta gu√≠a
echo.
echo ‚è≥ La primera ejecuci√≥n puede tardar unos segundos
echo üåê Se abrir√° autom√°ticamente en tu navegador
echo.
echo üí° CONSEJO: Mant√©n esta carpeta en un lugar seguro
echo           (como Documentos o Escritorio)
echo.
echo ========================================
echo.
pause